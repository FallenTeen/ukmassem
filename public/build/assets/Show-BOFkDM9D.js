import{b as ue,r as o,u as xe,j as e,H as me,L as ge}from"./app-P6dEBHuB.js";import{I as M}from"./input-error-DgnFeQNR.js";import{B as X}from"./badge-DvWSpYcc.js";import{B as x}from"./app-logo-icon-C6P0zqqK.js";import{S as A}from"./spinner-BOHTEugV.js";import{A as pe}from"./app-layout-DDwDYC06.js";/* empty css            */import"./index-EKCV0cNf.js";import"./index-XwOQEk2p.js";import"./loader-circle-DAQxbspK.js";import"./createLucideIcon-D2UukEZg.js";import"./index-Bpqn9jTr.js";import"./tooltip-BmFw5_9G.js";import"./progress-CYXrDxWg.js";import"./index-DQ55ufzE.js";const he={draft:"Draft",dijadwalkan:"Dijadwalkan",berlangsung:"Berlangsung",selesai:"Selesai",dibatalkan:"Dibatalkan"},fe={draft:"secondary",dijadwalkan:"default",berlangsung:"default",selesai:"outline",dibatalkan:"destructive"},je=a=>[{title:"Rapat",href:"/rapat"},{title:a.judul,href:`/rapat/${a.id}`}],U=a=>a==="proker"?"Proker":a==="non_proker"?"Non Proker":a||"-",ke=a=>a.target_peserta?a.target_peserta==="semua"?"Semua anggota aktif":a.target_peserta==="divisi"?`Divisi: ${(a.target_detail?.divisi??[]).join(", ")||"-"}`:a.target_peserta==="role"?`Role: ${(a.target_detail?.role??[]).join(", ")||"-"}`:a.target_peserta==="proker_team"?"Tim proker terkait":a.target_peserta==="custom"?`Custom, total ${(a.target_detail?.anggota_ids??[]).length} anggota`:a.target_peserta:"-",ve=a=>!a||!Array.isArray(a)?[]:a.map((r,m)=>{if(typeof r=="string")return{id:m,label:r,done:!1};if(typeof r=="object"&&r!==null){const g=r;return{id:m,label:String(g.label??g.text??`Item ${m+1}`),done:!!(g.done??g.checked??!1)}}return{id:m,label:`Item ${m+1}`,done:!1}});function Be({rapat:a,canManage:r,anggota:m}){const{auth:g}=ue().props,T=g.user,b=String(T.role??""),l=a.created_by===T.id||b==="rajawebsite"||b==="ketum_waketum"||b==="sekretaris",[p,W]=o.useState("detail"),[N,c]=o.useState(null),q={divisi:a.target_detail?.divisi??[],role:a.target_detail?.role??[],anggota_ids:a.target_detail?.anggota_ids??[]},{data:P,setData:E,put:R,processing:f,errors:I}=xe({judul:a.judul,jenis_rapat_id:String(a.jenis_rapat_id),kategori:a.kategori,proker_id:a.proker_id?String(a.proker_id):"",deskripsi:a.deskripsi??"",tanggal:a.tanggal,waktu_mulai:a.waktu_mulai??"",waktu_selesai:a.waktu_selesai??"",lokasi:a.lokasi??"",notulensi:a.notulensi??"",hasil:Array.isArray(a.hasil)?a.hasil.map(s=>String(s)):[],evaluasi:a.evaluasi??"",link_dokumentasi:a.link_dokumentasi??"",status:a.status,target_peserta:a.target_peserta,target_detail:q}),V=s=>{s.preventDefault(),r&&R(`/rapat/${a.id}`,{preserveScroll:!0,onSuccess:()=>{c({type:"success",message:"Notulensi rapat berhasil disimpan."})},onError:()=>{c({type:"error",message:"Gagal menyimpan notulensi rapat."})}})},Q=s=>{s.preventDefault(),r&&R(`/rapat/${a.id}`,{preserveScroll:!0,onSuccess:()=>{c({type:"success",message:"Evaluasi rapat berhasil disimpan."})},onError:()=>{c({type:"error",message:"Gagal menyimpan evaluasi rapat."})}})},y=a.waktu_mulai||a.waktu_selesai?[a.waktu_mulai,a.waktu_selesai].filter(Boolean).join(" - "):null,w=ve(a.hasil),Y=a.presensi_rapats??[],[d,u]=o.useState(()=>Y.map(s=>({...s,status_kehadiran:s.status_kehadiran||"alpa",keterangan:s.keterangan??"",selected:!1}))),[z,$]=o.useState(!1),[D,B]=o.useState(!1),[K,L]=o.useState(!1),[j,H]=o.useState(""),[O,G]=o.useState(""),[k,F]=o.useState(""),h=o.useMemo(()=>d.reduce((s,t)=>(s.total+=1,t.status_kehadiran==="hadir"&&(s.hadir+=1),t.status_kehadiran==="izin"&&(s.izin+=1),t.status_kehadiran==="sakit"&&(s.sakit+=1),t.status_kehadiran==="alpa"&&(s.alpa+=1),s),{total:0,hadir:0,izin:0,sakit:0,alpa:0}),[d]),J=o.useMemo(()=>new Set(d.map(s=>s.anggota_id)),[d]),S=o.useMemo(()=>m.filter(s=>!J.has(s.id)).sort((s,t)=>{const i=(s.nama_lengkap||s.user?.name||"").toLowerCase(),n=(t.nama_lengkap||t.user?.name||"").toLowerCase();return i.localeCompare(n)}),[m,J]),Z=o.useMemo(()=>{if(!k.trim())return S;const s=k.toLowerCase();return S.filter(t=>{const i=(t.nama_lengkap||t.user?.name||"").toLowerCase(),n=String(t.divisi??"").toLowerCase();return i.includes(s)||n.includes(s)})},[S,k]),_=d.some(s=>s.selected),ee=s=>{u(t=>t.map(i=>({...i,selected:s})))},se=(s,t)=>{u(i=>i.map(n=>n.anggota_id===s?{...n,selected:t}:n))},ae=(s,t)=>{u(i=>i.map(n=>n.anggota_id===s?{...n,status_kehadiran:t}:n))},te=(s,t)=>{u(i=>i.map(n=>n.anggota_id===s?{...n,keterangan:t}:n))},ne=s=>{u(t=>t.map(i=>i.selected?{...i,status_kehadiran:s}:i))},ie=()=>{u(s=>s.map(t=>t.selected?{...t,status_kehadiran:"alpa",keterangan:""}:t))},v=()=>typeof document>"u"?"":document.querySelector('meta[name="csrf-token"]')?.content??"",re=async()=>{if(!l)return;const s=v();if(s){B(!0);try{const t=await fetch(`/rapat/${a.id}/presensi/generate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify({})});if(!t.ok)throw new Error("Failed to generate presensi");const i=await t.json();u(i.map(n=>({...n,status_kehadiran:n.status_kehadiran||"alpa",keterangan:n.keterangan??"",selected:!1}))),c({type:"success",message:"Peserta rapat berhasil digenerate."})}catch{c({type:"error",message:"Gagal meng-generate peserta rapat."})}finally{B(!1)}}},le=async()=>{if(!l||d.length===0)return;const s=v();if(s){$(!0);try{const t={items:d.map(n=>({anggota_id:n.anggota_id,status_kehadiran:n.status_kehadiran,keterangan:n.keterangan||null}))};if(!(await fetch(`/rapat/${a.id}/presensi/bulk-update`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(t)})).ok)throw new Error("Failed to save presensi");c({type:"success",message:"Presensi rapat berhasil disimpan."})}catch{c({type:"error",message:"Gagal menyimpan presensi rapat."})}finally{$(!1)}}},de=async()=>{if(!l||!j)return;const s=v();if(s){L(!0);try{const t={anggota_id:Number.parseInt(j,10),status_kehadiran:"hadir",keterangan:O||null},i=await fetch(`/rapat/${a.id}/presensi/add-manual`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(t)});if(!i.ok)throw new Error("Failed to add manual presensi");const n=await i.json();u(C=>[...C,{...n,status_kehadiran:n.status_kehadiran||"hadir",keterangan:n.keterangan??"",selected:!1}]),H(""),G(""),F(""),c({type:"success",message:"Anggota berhasil ditambahkan ke presensi."})}catch{c({type:"error",message:"Gagal menambahkan anggota ke presensi."})}finally{L(!1)}}},oe=async s=>{if(!l)return;const t=v();if(!(!t||!window.confirm("Hapus anggota ini dari presensi rapat?")))try{if(!(await fetch(`/rapat/${a.id}/presensi/${s}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":t}})).ok)throw new Error("Failed to remove presensi");u(C=>C.filter(ce=>ce.anggota_id!==s)),c({type:"success",message:"Anggota dihapus dari presensi."})}catch{c({type:"error",message:"Gagal menghapus anggota dari presensi."})}};return e.jsxs(pe,{breadcrumbs:je(a),children:[e.jsx(me,{title:`Detail Rapat - ${a.judul}`}),e.jsxs("div",{className:"p-4",children:[N&&e.jsx("div",{className:"mb-4 rounded-md border px-4 py-3 text-sm shadow-sm md:max-w-md",children:e.jsx("div",{className:N.type==="success"?"text-green-800":"text-red-800",children:N.message})}),e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6 rounded-lg border bg-background p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:a.judul}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.jenis_rapat?.nama||"-"," • ",U(a.kategori)]}),a.proker&&e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Proker terkait:"," ",e.jsx("span",{className:"font-medium",children:a.proker.nama_lengkap})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx(X,{variant:fe[a.status]??"secondary",children:he[a.status]??a.status}),e.jsxs("span",{className:"text-muted-foreground",children:["Tanggal:"," ",e.jsx("span",{className:"font-medium",children:a.tanggal})]}),y&&e.jsxs("span",{className:"text-muted-foreground",children:["Waktu:"," ",e.jsx("span",{className:"font-medium",children:y})]}),r&&e.jsx(ge,{href:`/rapat/${a.id}/edit`,className:"text-xs font-medium text-primary hover:underline",children:"Edit Rapat"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 border-b pb-2 text-xs",children:["detail","notulensi","hasil","evaluasi","presensi"].map(s=>e.jsxs(x,{type:"button",size:"sm",variant:p===s?"default":"ghost",onClick:()=>W(s),children:[s==="detail"&&"Detail Rapat",s==="notulensi"&&"Notulensi",s==="hasil"&&"Hasil",s==="evaluasi"&&"Evaluasi",s==="presensi"&&"Presensi"]},s))}),p==="detail"&&e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Judul"}),e.jsx("div",{className:"font-medium",children:a.judul})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Jenis Rapat"}),e.jsx("div",{children:a.jenis_rapat?.nama||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Kategori"}),e.jsx("div",{children:U(a.kategori)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Proker Terkait"}),e.jsx("div",{children:a.proker?.nama_lengkap||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tanggal"}),e.jsx("div",{children:a.tanggal})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Waktu"}),e.jsx("div",{children:y||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Lokasi"}),e.jsx("div",{children:a.lokasi||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Link Dokumentasi"}),e.jsx("div",{children:a.link_dokumentasi?e.jsx("a",{href:a.link_dokumentasi,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:a.link_dokumentasi}):"-"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Deskripsi"}),e.jsx("div",{children:a.deskripsi||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Target Peserta"}),e.jsx("div",{children:ke(a)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dibuat oleh"}),e.jsxs("div",{children:[a.creator?.name||"-"," ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.creator?.email||"tanpa email",")"]})]})]})]}),p==="notulensi"&&e.jsxs("form",{onSubmit:V,className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Notulensi Rapat"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Isi ringkasan pembahasan rapat di sini."})]}),!r&&e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Hanya pembuat rapat atau ketum yang dapat mengubah notulensi."})]}),e.jsx("textarea",{className:"mt-2 min-h-[200px] w-full rounded-md border bg-background px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:P.notulensi,onChange:s=>E("notulensi",s.target.value),disabled:!r}),e.jsx(M,{message:I.notulensi})]}),r&&e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(x,{type:"submit",disabled:f,children:f?"Menyimpan...":"Simpan Notulensi"})})]}),p==="hasil"&&e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Hasil dan Keputusan Rapat"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Daftar ini bersifat hanya baca. Pengelolaan detail hasil dapat dilakukan dari modul lain jika diperlukan."})]}),w.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Belum ada hasil yang tercatat untuk rapat ini."}),w.length>0&&e.jsx("ul",{className:"space-y-1 text-xs",children:w.map(s=>e.jsxs("li",{className:"flex items-start gap-2 rounded-md border bg-muted/40 px-3 py-2",children:[e.jsx("span",{className:"mt-0.5 text-xs",children:s.done?"☑":"☐"}),e.jsx("span",{children:s.label})]},s.id))})]}),p==="evaluasi"&&e.jsxs("form",{onSubmit:Q,className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Evaluasi Rapat"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Catat evaluasi dan tindak lanjut rapat di sini."})]}),!r&&e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Hanya pembuat rapat atau ketum yang dapat mengubah evaluasi."})]}),e.jsx("textarea",{className:"mt-2 min-h-[200px] w-full rounded-md border bg-background px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:P.evaluasi,onChange:s=>E("evaluasi",s.target.value),disabled:!r}),e.jsx(M,{message:I.evaluasi})]}),r&&e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(x,{type:"submit",disabled:f,children:f?"Menyimpan...":"Simpan Evaluasi"})})]}),p==="presensi"&&e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Presensi Rapat"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kelola daftar kehadiran peserta rapat."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px]",children:[e.jsxs("div",{className:"rounded-full border bg-muted/50 px-3 py-1",children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",h.total,e.jsx("span",{className:"mx-1.5",children:"•"}),e.jsxs("span",{className:"text-green-700",children:["Hadir ",h.hadir]}),e.jsxs("span",{className:"mx-1.5 text-yellow-700",children:["Izin ",h.izin]}),e.jsxs("span",{className:"mx-1.5 text-blue-700",children:["Sakit ",h.sakit]}),e.jsxs("span",{className:"mx-1.5 text-red-700",children:["Alpa ",h.alpa]})]}),l&&d.length===0&&e.jsxs(x,{type:"button",size:"sm",onClick:re,disabled:D,children:[D&&e.jsx(A,{className:"mr-1.5 size-3"}),"Generate Peserta"]}),l&&d.length>0&&e.jsxs(x,{type:"button",size:"sm",variant:"outline",onClick:le,disabled:z,children:[z&&e.jsx(A,{className:"mr-1.5 size-3"}),"Simpan Presensi"]})]})]}),l&&d.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-md border bg-muted/40 px-3 py-2",children:[e.jsx("span",{className:"text-[11px] font-medium",children:"Aksi cepat untuk baris terpilih:"}),e.jsx(x,{type:"button",size:"xs",variant:"outline",disabled:!_,onClick:()=>ne("hadir"),children:"Tandai Hadir"}),e.jsx(x,{type:"button",size:"xs",variant:"outline",disabled:!_,onClick:ie,children:"Reset Status"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:_?"Beberapa baris dipilih.":"Pilih baris presensi untuk mengaktifkan aksi."})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border bg-background",children:e.jsxs("table",{className:"w-full min-w-[720px] text-left text-xs",children:[e.jsx("thead",{className:"sticky top-0 z-10 border-b bg-muted/60 text-[11px] uppercase text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:l&&d.length>0&&e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:d.length>0&&d.every(s=>s.selected),onChange:s=>ee(s.target.checked)})}),e.jsx("th",{className:"px-3 py-2",children:"Nama"}),e.jsx("th",{className:"px-3 py-2",children:"Divisi"}),e.jsx("th",{className:"px-3 py-2",children:"Status Kehadiran"}),e.jsx("th",{className:"px-3 py-2",children:"Keterangan"}),l&&e.jsx("th",{className:"px-3 py-2 text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:l?6:5,className:"px-3 py-4 text-center text-xs text-muted-foreground",children:"Belum ada data presensi untuk rapat ini."})}),d.map(s=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/40",children:[e.jsx("td",{className:"px-3 py-2",children:l&&e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:s.selected,onChange:t=>se(s.anggota_id,t.target.checked)})}),e.jsx("td",{className:"px-3 py-2",children:s.anggota?.nama_lengkap||s.anggota?.user?.name||`ID ${s.anggota_id}`}),e.jsx("td",{className:"px-3 py-2",children:s.anggota?.divisi||"-"}),e.jsx("td",{className:"px-3 py-1",children:l?e.jsxs("select",{className:"h-8 w-full rounded-md border bg-background px-2 text-xs shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:s.status_kehadiran,onChange:t=>ae(s.anggota_id,t.target.value),children:[e.jsx("option",{value:"hadir",children:"Hadir"}),e.jsx("option",{value:"izin",children:"Izin"}),e.jsx("option",{value:"sakit",children:"Sakit"}),e.jsx("option",{value:"alpa",children:"Alpa"})]}):e.jsx(X,{variant:"outline",children:s.status_kehadiran})}),e.jsx("td",{className:"px-3 py-1",children:l?e.jsx("textarea",{className:"h-8 w-full rounded-md border bg-background px-2 py-1 text-xs shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:s.keterangan??"",onChange:t=>te(s.anggota_id,t.target.value)}):e.jsx("span",{children:s.keterangan||"-"})}),l&&e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx(x,{type:"button",size:"xs",variant:"outline",onClick:()=>oe(s.anggota_id),children:"Hapus"})})]},s.id))]})]})}),l&&e.jsxs("div",{className:"space-y-2 rounded-lg border bg-muted/40 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-semibold",children:"Tambah Anggota Manual"}),e.jsx("input",{type:"text",className:"h-8 w-full max-w-[200px] rounded-md border bg-background px-2 text-xs shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",placeholder:"Cari nama atau divisi",value:k,onChange:s=>F(s.target.value)}),e.jsxs("select",{className:"h-8 w-full max-w-[260px] rounded-md border bg-background px-2 text-xs shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:j,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"",children:"Pilih anggota"}),Z.map(s=>e.jsx("option",{value:String(s.id),children:(s.nama_lengkap||s.user?.name||"-")+(s.divisi?` • ${s.divisi}`:"")},s.id))]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("textarea",{className:"h-8 w-full max-w-[260px] rounded-md border bg-background px-2 py-1 text-xs shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",placeholder:"Keterangan (opsional)",value:O,onChange:s=>G(s.target.value)}),e.jsxs(x,{type:"button",size:"xs",onClick:de,disabled:K||!j,children:[K&&e.jsx(A,{className:"mr-1.5 size-3"}),"Tambah Anggota"]})]})]})]})]})]})]})}export{Be as default};
